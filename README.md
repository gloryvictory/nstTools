# Описание скрипта main.py

Этот Python-скрипт создает графический интерфейс с использованием библиотеки Dear PyGui для управления слоями географических карт, хранящихся в базе данных PostgreSQL. Он позволяет подключаться к базе данных, просматривать карты и их слои, а также копировать слои из одной карты в другую с проверкой на дубликаты. Ниже описаны основные функции скрипта:

## Основные функции

1. **Подключение к базе данных PostgreSQL**:
   - Пользователь вводит параметры подключения (хост, порт, имя базы данных, имя пользователя, пароль) через окно интерфейса.
   - Скрипт устанавливает соединение с базой данных, загружает список карт (`maps`) и их слоев (`layers`) с помощью SQL-запросов.
   - Параметры подключения по умолчанию задаются в конфигурации `DB_CONFIG`.

2. **Графический интерфейс**:
   - Скрипт создает два основных окна:
     - **Окно подключения**: для ввода параметров базы данных и установления соединения.
     - **Основное окно**: содержит две панели (левая — исходная карта, правая — целевая карта) для работы со слоями.
   - В каждой панели есть:
     - Выпадающий список (`combo`) для выбора карты.
     - Список слоев (`listbox`) для выбранной карты.
     - Кнопка для копирования выбранного слоя из левой карты в правую.
   - Поддерживается переключение полноэкранного режима и навигация между окнами через меню.

3. **Функциональность работы со слоями**:
   - Пользователь может выбрать карту в каждой панели, после чего отображается список связанных с ней слоев.
   - Выбор слоя в левой панели и нажатие кнопки «Копировать в правую» позволяет скопировать слой в целевую карту.
   - Перед копированием проверяется, нет ли уже такого слоя в целевой карте (по `map_id`, `name_ru`, `type`).
   - Если слой успешно скопирован, он добавляется в базу данных и обновляется список слоев в правой панели.

4. **Логирование**:
   - Все SQL-запросы и действия пользователя логируются в файл `db_operations.log` и выводятся в терминал с временными метками.
   - Логи включают информацию об успешных операциях, ошибках и параметрах запросов.

5. **Обработка ошибок**:
   - Скрипт обрабатывает ошибки подключения к базе данных, ошибки SQL-запросов и другие исключения, отображая сообщения об ошибках в интерфейсе.
   - В случае ошибки копирования транзакция откатывается (`rollback`).

6. **Глобальные переменные**:
   - Хранят соединение с базой данных (`db_connection`), списки карт (`all_maps`) и слоев (`all_layers`), а также текущие выбранные карты и слои для каждой панели.

7. **Основные особенности**:
   - Использует модуль `psycopg2` для взаимодействия с PostgreSQL.
   - Логирование осуществляется через модуль `logging` с выводом в файл и консоль.
   - Интерфейс поддерживает динамическое обновление списков карт и слоев на основе данных из базы.

## Итог

Скрипт предоставляет удобный инструмент для управления слоями карт в базе данных PostgreSQL, с возможностью просмотра, выбора и копирования слоев между картами, обеспечивая при этом логирование операций и обработку ошибок.